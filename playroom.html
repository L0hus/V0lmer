<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Playroom</title>
		<link rel="icon" href="img/shrug.ico" type="image/x-icon">
        <link rel="stylesheet" href="css/style.css">
        <link href='https://fonts.googleapis.com/css?family=VT323' rel='stylesheet'>
        <link href='https://fonts.googleapis.com/css?family=Play:400,700' rel='stylesheet' type='text/css'>
    </head>
    <body>
        <div class="playroom-container" >
            <div class="computer-container">
                <pre class="monitor-art">
                                         _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
                                       /                                                                         /\	
                                     /                                                                          /  |
                                   /                                                                           /   |
                                 /                                                                            /    |
                             _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _   /     |
                           /  	                                                                           \       |
                          |      _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _      |      |
                          |     /                                                                     \     |      |
                          |    |                                                                       |    |      |
                          |    |                                                                       |    |      |
                          |    |                                                                       |    |      |            
                          |    |                                                                       |    |      |            
                          |    |                                                                       |    |      | 
                          |    |                                                                       |    |      | 
                          |    |                                                                       |    |      |   
                          |    |                                                                       |    |      |        
                          |    |                                                                       |    |      |      
                          |    |                                                                       |    |      |     
                          |    |                                                                       |    |      /     
                          |    |                                                                       |    |     /     
                          |    |                                                                       |    |    /         
                          |    |                                                                       |    |   |        
                          |    |                                                                       |    |   |       
                          |    |                                                                       |    |   |    
                          |    |                                                                       |    |   |    
                          |    |                                                                       |    |   |    
                          |    |                                                                       |    |   |    
          _ _ _ _ _ _ _ _ |    |                                                                       |    |   | _ _ _ _ _ _ _ _   
         /                |    |                                                                       |    |   |               /|   
        /                 |    |                                                                       |    |   |              / |
       /                  |    |                                                                       |    |   /             /  |
      /                   |    |                                                                       |    |  /             /   |
     /                    |     \_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _/     | /             /    |
    /                     |                                                                                 |/             /     |
   /                       \ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ /              /      |
  /                                                                                                                      /       |
 /                                                                                                                      /        | 
/_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ /         |   
|                                                                                                                     |         /    
|                                                                                                                     |        /    
|                                                                                                                     |       /
|                                                                                                                     |      /
|                                                                       |- - - - - - - - - - - - -|                   |     /
|         ___   ___                                                                                                   |    /
|        |   | |   |                                                                                                  |   /
|        |___| |___|                                                    |- - - - - - - - - - - - -|                   |  /
|                                                                                                                     | /
|_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _|/
                </pre>
                <div>
                    <button class="btn-enable-selection" id="second-patern"><pre> ___ <br>|   |<br>|___|</pre></button>
                    <pre style="font-size: 12px; text-align: start; margin-top: 100%" class="logo">
                 ▄█▄
                ▄███▄
               ▄█████▄
              ▄███████▄
             ▄ ▀▀██████▄
            ▄██▄▄ ▀█████▄
           ▄█████████████▄
          ▄███████████████▄
         ▄█████████████████▄
        ▄███████████████████▄
       ▄█████████▀▀▀▀████████▄
      ▄████████▀      ▀███████▄
     ▄█████████        ████▀▀██▄
    ▄██████████        █████▄▄▄
   ▄██████████▀        ▀█████████▄
  ▄██████▀▀▀              ▀▀██████▄
 ▄███▀▀                       ▀▀███▄
▄▀▀                               ▀▀▄
                    </pre>
                </div>
                <div class="desktop">
                    <button class="linux" id="linux-hi"><pre>         _nnnn_<br>        dGGGGMMb<br>       @p~qp~~qMb<br>       M|@||@) M|<br>       @,----.JM|<br>      JS^\__/  qKL<br>     dZP        qKRb<br>    dZP          qKKb<br>   fZP            SMMb<br>   HZM            MMMM<br>   FqM            MMMM<br> __| ".        |\dS"qML<br> |    `.       | `' \Zq<br>_)      \.___.,|     .'<br>\____   )MMMMMP|   .'<br>     `-'       `--'</pre></button>
                    <pre class="linux-hi">
   ,"""""""".
   | Hello! |
  _;........'
-'	
                    </pre>
                    <div>
                        <button id="invaders" class="invaders"><pre class="invaders-logo"> \__/<br> (oo)<br>//||\\<br><pre class="invaders-header">  Bug<br>Bounty</pre></pre><button>
                	</div>
            	</div>
        	</div>
        	<canvas id="canvas" class="game"></canvas>
		</div>
		<div class="sry-1024">
<p style="text-align: center; font-family: 'VT323', monospace; font-size: 24px; margin-top: 30%;">This page is not adapted to<br>
	your screen resolution</p>
			<pre style="font-size: 26px; margin-top: 5%;">
		  	    ¯\_(ツ)_/¯
			</pre>
		</div>
		<footer class="playroom-footer">
			<a href="ursec.html"><<< --- Back to UrSec page</a>
			<a href="index.html">Back to Main page --- >>></a>
		</footer>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
        <script>
            $("#second-patern").click(function() {
                $('.logo').toggleClass('logo-active');
                $('.desktop').toggleClass('desktop-active');
				$('.game').removeClass('game-active');
				$('.lihux-hi').removeClass('linux-hi-active')
            });

            $("#linux-hi").click(function() {
                $('.linux-hi').toggleClass('linux-hi-active');						 
            });	

            $("#invaders").click(function() {
                $('.game').toggleClass('game-active');
				$('.linux-hi').removeClass('linux-hi-active');
				$('.linux').toggleClass('linux-active');
            });
        </script>
        <script>

			// ------------------------------------------------------------
			// global stuff
			// ------------------------------------------------------------

			const CTX = canvas.getContext('2d')
			const AUDIO = new AudioContext()

			const KEYS = {}

			const SIZE = 18
			const VIEW = 10
			const ILLUMINATION = 5

			const MAP_X = 72
			const MAP_Y = 30
			const MAP = `
			+──────────────────────────────────────────────────────────────────────+
			|........***..1....    .............***..........11.......             |
			|.p.11...**....111..    ..**whoami...........**.*......1..1            |
			|3w*****...**..1.1***...    ....***......*....***.........1..          |
			|1d.*..1...11*....1.......      ........**............***..........    |
			| 1...***....**............   ..1..***.......****........**.....**3..  |
			|      ...................1.....**............;33.............*****...*|
			|         ............**....11*..............;3;..................1..**|
			|     .....****...........****.........................................|
			|     3.............................................................**.|
			|       ..................................................3.....3......|
			|            3...................................+─────────────────────+
			|               ................................3|:vi:::::::::####o#{}:|
			|                   ............................3|:::::::::::::::::::::|
			+───+          +────────+.mm.mm.....     ........|:::::::::::::::::::::|
			|:::|          |:##o{}::|........... 1 1 ........+──────+::::::::::::::|
			|:::|3.........|::::::::|.mm.mm.....     ..........3.3..|:::::::┻━┻::::|
			|:::|....**....|:;#;::::(........... 1 1 ...............)::::::::::::::|
			|:::(....**....|::::::::|.mm.mm.....     ...............|rm:-rf:/::::::|
			+───+....**....+────────+........... 1 1 ...............+──────────────+
			|...................................     ..............................|
			+───────────────────────+................................-1-..-1-..-1-.|
			|:/:~:::::::::::::::::::|3.............................................|
			|::::::::::::::::;##;:::|3.............................................|
			|:::===#:|:::::::;##;:::(............ooo..............#................|
			+────────+::::::::::::::|...........o   o............#^#...............|
			|*.......|::::::::::::::|..&........o 2 o.............#................|
			|...*....)::::::::::::::|...........o   o..............................|
			|cat.jpg3|{}#####0##....|.drwxrwxr-x.ooo0.arcs..arcs...........m...33..|
			+────────+──────────────+──────────────────────────────────────────────+`
				.split('\n')
				.join('')

			const CHARS_FLOOR = '.*:-drwx0oac&hmivsfngertlpj/'
			const CHARS_CEILING = '()~$'
			const CHARS_IGNORE = '.:()'

			const CHARS_THINGS = ['DONT USE THIS', '·Xx·  ', '.^    ', '......']

			const MESSAGES = ['BOOM!', 'Nice one!', 'ez clap!', 'Good job!', 'OWNED!']

			const TYPE_SPEED = 8

			let width, height
			let start, then
			let posX, posY
			let gameover

			let textQueue = []
			let text = ''
			let blink = 0
			let type = 0
			let status = 0

			let bugs
			let mover = 0
			let bugSpeed
			let shots
			let kills
			let powered
			let beamGain

			let loading

			// ------------------------------------------------------------
			// functions
			// ------------------------------------------------------------
			const timestamp = _ => new Date().getTime()

			const getChar = (x, y) =>
				x >= MAP_X || x < 0 || y >= MAP_Y || y < 0 ? '1' : MAP[MAP_X * y + x]

			const anotherBug = _ => {
				let r = (Math.random() * MAP.length) | 0
				while (MAP[r] != ':' && MAP[r] != '.') r = (r + 1) % (MAP.length - 1)
				bugs.push(r % MAP_X, r / MAP_X | 0)
			}

			// ------------------------------------------------------------
			// setup globals
			// ------------------------------------------------------------
			function reset() {
				start = then = timestamp()

				posX = MAP_X - 8
				posY = MAP_Y - 3

				bugs = []
				shots = []
				kills = 0

				bugSpeed = 1.5
				bugs.push(posX, posY - 3)

				for (let i = 0; i < 6; i++) anotherBug()

				gameover = false
				loading = -VIEW
			}

			reset()

			textQueue.push('* WARNING *')
			textQueue.push('BUGS CORRUPT YOUR ~')
			textQueue.push(_ => (powered = true))
			textQueue.push('~ $ sudo enable-gun (s)')

			// ------------------------------------------------------------
			// game loop
			// ------------------------------------------------------------

			function update(delta) {

				CTX.clearRect(-width / 2, -height / 2, width, height)
				CTX.globalCompositeOperation = 'hard-light'

				// update bugs
				if (!gameover) mover += delta
				if (mover > bugSpeed) {
					mover = 0

					playMoveBug()

					for (let i = 0; i < bugs.length; i += 2) {
						let options = [
							bugs[i] + 1, bugs[i + 1],
							bugs[i] - 1,  bugs[i + 1],
							bugs[i],        bugs[i + 1] + 1,
							bugs[i],        bugs[i + 1] - 1
						]

						for (let j = 0; j < 4; j++) {
							var r = ((Math.random() * options.length / 2) | 0) * 2
							if (CHARS_IGNORE.indexOf(getChar(options[r], options[r + 1] - 1)) != -1) {
								bugs[i] = options[r]
								bugs[i + 1] = options[r + 1]
								break
							}
						}
					}
				}

				// draw MAP

				let offsetX = posX * SIZE
				let offsetY = posY * SIZE

				if (loading < 10) loading += 20 * delta

				for (let y = posY - VIEW; y < posY + VIEW && y - posY <= loading;	y++) {
					MAP: for (let x = posX - VIEW; x < posX + VIEW; x++) {
						// bugs
						for (let i = 0; i < bugs.length; i += 2) {
							if (bugs[i] == x && bugs[i + 1] == y + 1) {
								CTX.fillStyle = `hsl(0, 100%, 40%)`
								CTX.fillText('�', bugs[i] * SIZE - offsetX, bugs[i + 1] * SIZE - offsetY)

								if (y + 1 === posY && x === posX && !gameover) {
									gameover = true
									powered = true

									textQueue.length = 0
									textQueue.push('* SEGMENTATION FAULT *')
									textQueue.push(`YOU MADE ${kills} FIXES`)
									textQueue.push('LOADING BACKUP...')
									textQueue.push(reset)
								}

								continue MAP
							}
						}

						// you
						if (y + 1 === posY && x === posX) {
							// draw you
							CTX.fillStyle = '#fff'
							CTX.fillText('$', 0, 0)
							continue
						}

						// multi-layer
						for (let i = 1; i < 7; i++) {
							let char = getChar(x, y)

							if (parseInt(getChar(x, y))) char = CHARS_THINGS[char * 1][i - 1]
							else if (i > 1 && CHARS_FLOOR.indexOf(char) > -1) break
							else if (i < 6 && CHARS_CEILING.indexOf(char) > -1) continue

							let d = Math.hypot(x - posX, y - posY + 1)
							let offset = -d / 3 * i

							let glow = i * 7
							if (i == 1) glow += 10
							if (d < ILLUMINATION) glow += d < 8 ? 40 : 0

							CTX.fillStyle = `hsl(0, 0%, ${glow}%)`
							CTX.fillText(
								char,
								x * SIZE - offsetX + (x > posX ? -offset : offset),
								y * SIZE + SIZE - offsetY + (y > posY ? -offset : offset)
							)
						}
					}
				}

				// stream
				if (KEYS.KeyS && !gameover && powered) {
					var x = 0
					if (KEYS.ArrowLeft) --x
					if (KEYS.ArrowRight) ++x

					var y = 0
					if (KEYS.ArrowUp) --y
					if (KEYS.ArrowDown) ++y

					CTX.fillStyle = `hsl(120, 100%, 40%)`

					for (let i = 1; i < ILLUMINATION; i++) {
						let ix = x * i + posX
						let iy = posY - 1 + y * i
						let char = getChar(ix, iy)

						// edge
						if (CHARS_IGNORE.indexOf(char) == -1 && char != ' ') break
						// bug
						for (let i = 0; i < bugs.length; i += 2) {
							if (bugs[i] == ix && bugs[i + 1] - 1 == iy) {
								if (kills == 0) textQueue.push(`Nice fix! +1`)
								else
									textQueue.push(`${MESSAGES[(Math.random() * MESSAGES.length) | 0]} ${kills} +1`)
								bugs.splice(i, 2)
								kills += 1
								bugSpeed *= 0.85
								anotherBug()
								playDie()
							}
						}

						CTX.fillText(
							String.fromCharCode(Math.random() * 256 |0),
							x * i * SIZE,
							y * i * SIZE
						)
					}
				}

				// messages
				type += TYPE_SPEED * delta
				if (type > text.length + 10) {
					text = textQueue.shift() || ''
					if (typeof text === 'function') {
						text(),text = ''
					}
					type = -1
					status = 0
				}

				blink = blink > 1 ? 0 : blink + delta
				var cursor = blink > 0.5 || textQueue.length == 0 ? '⠀' /*speical whitespace */ : '█'

				if(text.length > 0 && text.length > status && status != (type | 0)) playType()
				status = type | 0

				write(text.substring(0, status) + cursor)
			}

			function write(txt) {
				CTX.save()
				CTX.textBaseline = 'top'
				CTX.fillStyle = '#000'

				var width = CTX.measureText(txt).width
				var y = -SIZE * 4

				CTX.fillRect(-width / 2, y - 3, width - SIZE /*for cursor*/, SIZE + 3)

				CTX.fillStyle = '#fff'
				CTX.fillText(txt, 0, y)
				CTX.restore()
			}

			addEventListener(
				'resize',
				(function _self(e) {
					width = canvas.width = window.innerWidth
					height = canvas.height = window.innerHeight

					CTX.translate(width / 2, height / 2)
					CTX.textAlign = 'center'
					CTX.font = SIZE + 'px Cousine'

					return _self
				})()
			)

			;(function loop() {
				requestAnimationFrame(loop)

				let now = timestamp()
				let delta = now - then

				then = now
				update(delta / 1000)
			})()

			// ------------------------------------------------------------
			// audio
			// ------------------------------------------------------------

			function beep(type, frequency, volume, delay) {
				var o = AUDIO.createOscillator()
				o.frequency.value = 	frequency
				o.type = type
				var  g = AUDIO.createGain()
				g.gain.value = volume
				o.connect(g)
				g.connect(AUDIO.destination)
				o.start(0)
				g.gain.exponentialRampToValueAtTime(0.00001, AUDIO.currentTime + delay)
			}

			const playType = _ => beep('triangle', 554.4, 0, 0.1)
			const playMove = _ => beep('sine', 261.6, 0, 0.2)
			const playMoveBug = _ => beep('sine', 220.0, 0, 0.3)
			const playDie = _ => beep('square', 740.0, 0, 1)

			addEventListener('click', function() {
				var o = AUDIO.createOscillator()
				o.frequency.value = 38.89
				o.type = 'sawtooth'
				beamGain = AUDIO.createGain()
				beamGain.gain.exponentialRampToValueAtTime(0.00001, AUDIO.currentTime + 0.1)
				o.connect(beamGain)
				beamGain.connect(AUDIO.destination)
				o.start(0)
			})

			// ------------------------------------------------------------
			// controlls
			// ------------------------------------------------------------

			addEventListener(`keydown`, function(e) {
				if (gameover || KEYS.KeyS) return

				if (e.code === 'ArrowUp') {
					e.preventDefault()
					if (CHARS_IGNORE.indexOf(getChar(posX, posY - 2)) != -1) {
						--posY
						playMove()
					}
					return
				}

				if (e.code === 'ArrowDown') {
					e.preventDefault()
					if (CHARS_IGNORE.indexOf(getChar(posX, posY)) != -1) {
						++posY
						playMove()
					}
					return
				}

				if (e.code === 'ArrowLeft') {
					e.preventDefault()
					if (CHARS_IGNORE.indexOf(getChar(posX - 1, posY - 1)) != -1) {
						--posX
						playMove()
					}
					return
				}

				if (e.code === 'ArrowRight') {
					e.preventDefault()
					if (CHARS_IGNORE.indexOf(getChar(posX + 1, posY - 1)) != -1) {
						++posX
						playMove()
					}
					return
				}
			})

			const keyUpdate = e => {
				KEYS[e.code] = e.type === `keydown`

				if(e.code == 'KeyS' && !gameover && powered) {
					if(e.type === `keydown`) beamGain.gain.exponentialRampToValueAtTime(0.4, AUDIO.currentTime + 0.2)
					else beamGain.gain.exponentialRampToValueAtTime(0.00001, AUDIO.currentTime + 0.2)
				}

				e.preventDefault()
			}
			addEventListener(`keydown`, keyUpdate)
			addEventListener(`keyup`, keyUpdate)
        </script>
    </body>
</html>
